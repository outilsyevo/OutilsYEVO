<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur Rentabilit√© YEVO - Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Syne:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #5747f9;
            --primary-dark: #211a63;
            --secondary: #FF4991;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f5f5f5;
            --card-bg: #ffffff;
            --text: #111827;
            --text-light: #6b7280;
            --border: #e5e5e5;
            --shadow: rgba(0,0,0,0.08);
        }
        
        [data-theme="dark"] {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
            --shadow: rgba(0,0,0,0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Syne', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 15px;
            color: var(--text);
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 8px 32px var(--shadow);
            overflow: hidden;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 15s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .header h1 {
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 1.8em;
            margin: 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 0.9em;
            opacity: 0.95;
            margin: 6px 0 0 0;
            font-weight: 500;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            position: relative;
            z-index: 1;
        }
        
        .btn-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        .btn-icon:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .content {
            padding: 25px 30px;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px 8px 0 0;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.95em;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: var(--primary);
            background: var(--card-bg);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .main-grid.single-column {
            grid-template-columns: 1fr;
        }
        
        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px var(--shadow);
            transition: all 0.3s ease;
        }
        
        .section:hover {
            box-shadow: 0 8px 24px var(--shadow);
            transform: translateY(-2px);
        }
        
        .section-title {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1em;
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding: 10px 15px;
            background: linear-gradient(to right, var(--bg), var(--card-bg));
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title::before {
            content: 'üìä';
            font-size: 1.1em;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
            font-size: 0.85em;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Syne', sans-serif;
            font-size: 0.95em;
            transition: all 0.3s;
            background: var(--card-bg);
            color: var(--text);
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(87, 71, 249, 0.1);
            transform: scale(1.01);
        }
        
        .result-card {
            background: linear-gradient(135deg, var(--bg) 0%, var(--card-bg) 100%);
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .result-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .result-label {
            font-size: 0.85em;
            color: var(--text-light);
            font-weight: 600;
        }
        
        .result-value {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.1em;
            color: var(--text);
        }
        
        .result-value.highlight {
            font-size: 1.3em;
            color: var(--primary);
            text-shadow: 0 2px 8px rgba(87, 71, 249, 0.2);
        }
        
        .summary-item {
            background: linear-gradient(135deg, rgba(87, 71, 249, 0.05) 0%, rgba(87, 71, 249, 0.02) 100%);
            padding: 14px 16px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .summary-item:hover {
            background: linear-gradient(135deg, rgba(87, 71, 249, 0.1) 0%, rgba(87, 71, 249, 0.05) 100%);
            transform: translateX(3px);
            box-shadow: 0 4px 12px rgba(87, 71, 249, 0.15);
        }
        
        .summary-item.highlight-item {
            background: linear-gradient(135deg, rgba(87, 71, 249, 0.15) 0%, rgba(87, 71, 249, 0.08) 100%);
            border-left-color: var(--secondary);
        }
        
        .summary-item.highlight-item:hover {
            background: linear-gradient(135deg, rgba(87, 71, 249, 0.2) 0%, rgba(87, 71, 249, 0.1) 100%);
        }
        
        .summary-label {
            font-size: 0.9em;
            color: var(--text);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .summary-value {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.15em;
            color: var(--text);
        }
        
        .summary-value.highlight {
            font-size: 1.4em;
            color: var(--primary);
            font-weight: 800;
        }
        
        .marge-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(87, 71, 249, 0.3);
        }
        
        .marge-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: rotate 20s infinite linear;
        }
        
        .marge-section::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -30%;
            width: 150%;
            height: 150%;
            background: radial-gradient(circle, rgba(255, 73, 145, 0.1) 0%, transparent 70%);
            animation: rotate 25s infinite linear reverse;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .marge-title {
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 1.4em;
            margin-bottom: 15px;
            text-align: center;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            letter-spacing: 0.5px;
        }
        
        .gauge-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .gauge-wrapper {
            background: rgba(255, 255, 255, 0.15);
            padding: 18px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .gauge-label {
            font-size: 0.8em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 600;
        }
        
        .gauge-value {
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 1.6em;
            margin: 8px 0;
        }
        
        .gauge-canvas {
            margin: 15px auto;
            display: block;
        }
        
        .marge-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            position: relative;
            z-index: 1;
            margin-bottom: 15px;
        }
        
        .marge-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 14px;
            border-radius: 10px;
            backdrop-filter: blur(15px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .marge-item:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .marge-item-label {
            font-size: 0.75em;
            opacity: 0.95;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .marge-item-value {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.3em;
            line-height: 1.2;
        }
        
        .marge-controls {
            background: rgba(255, 255, 255, 0.25);
            padding: 18px;
            border-radius: 16px;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .marge-controls .form-group {
            margin-bottom: 12px;
        }
        
        .marge-controls label {
            color: white;
            font-weight: 700;
            font-size: 0.85em;
            margin-bottom: 6px;
            display: block;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .marge-controls input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary-dark);
            transition: all 0.3s ease;
        }
        
        .marge-controls input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }
        
        .marge-result-card {
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary-dark);
            padding: 14px;
            border-radius: 10px;
            margin-top: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        .marge-result-card .result-label {
            color: var(--text-light);
            font-size: 0.85em;
            margin-bottom: 6px;
        }
        
        .marge-result-card .result-value {
            color: var(--primary);
            font-size: 1.4em;
            font-weight: 800;
        }
        
        .chart-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .btn-primary {
            padding: 14px 36px;
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.05em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 6px 20px rgba(87, 71, 249, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(87, 71, 249, 0.5);
        }
        
        .btn-primary:active {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            padding: 10px 20px;
            background: var(--card-bg);
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Syne', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .scenario-manager {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .scenario-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .scenario-card {
            background: linear-gradient(135deg, var(--bg) 0%, var(--card-bg) 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .scenario-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 8px 20px var(--shadow);
        }
        
        .scenario-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(87, 71, 249, 0.1) 0%, var(--card-bg) 100%);
        }
        
        .scenario-name {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .scenario-details {
            font-size: 0.85em;
            color: var(--text-light);
            line-height: 1.6;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .comparison-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid var(--border);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .comparison-card h3 {
            font-family: 'Outfit', sans-serif;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }
        
        .package-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 0;
            border: 1px solid var(--border);
            margin-top: 20px;
            box-shadow: 0 4px 12px var(--shadow);
            overflow: hidden;
        }
        
        .package-section-content {
            padding: 18px;
        }
        
        .package-title {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.1em;
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding: 10px 15px;
            background: linear-gradient(to right, var(--bg), rgba(87, 71, 249, 0.1));
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .package-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border);
        }
        
        .package-table th {
            background: var(--primary-dark);
            color: white;
            padding: 16px 20px;
            text-align: left;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.95em;
            letter-spacing: 0.5px;
        }
        
        .package-table th.text-right {
            text-align: right;
        }
        
        .package-table td {
            padding: 14px 20px;
            border-bottom: 1px solid var(--border);
            font-size: 0.95em;
            color: var(--text);
        }
        
        .package-table tr:last-child td {
            border-bottom: none;
        }
        
        .package-table .category-row td {
            background: var(--bg);
            font-weight: 700;
            color: var(--text);
            padding: 12px 20px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .package-table .total-row td {
            background: var(--primary-dark);
            color: white;
            font-weight: 700;
            font-size: 1.1em;
            padding: 18px 20px;
        }
        
        .text-right {
            text-align: right;
        }
        
        .hidden {
            display: none;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.4s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success);
            color: var(--success);
        }
        
        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
            color: var(--warning);
        }
        
        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-group input {
            flex: 1;
        }
        
        /* Menu d'export */
        .export-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 8px 24px var(--shadow);
            padding: 8px;
            min-width: 200px;
            z-index: 1000;
            animation: slideDown 0.3s ease;
        }
        
        .export-option {
            width: 100%;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            text-align: left;
            font-family: 'Syne', sans-serif;
            font-weight: 600;
            font-size: 0.95em;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 4px;
        }
        
        .export-option:hover {
            background: var(--bg);
            color: var(--primary);
        }
        
        .export-option:last-child {
            margin-bottom: 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.5em;
            color: var(--primary-dark);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: var(--bg);
            color: var(--text);
        }
        
        /* Styles pour le Package Consultant */
        .package-header {
            background: url('TEMPLATE_NOTION.png') center center / cover no-repeat;
            color: white;
            padding: 0;
            margin: 0 0 30px 0;
            position: relative;
            overflow: hidden;
            min-height: 200px;
            border-radius: 0;
        }
        
        .package-header-content {
            position: relative;
            z-index: 1;
            width: 100%;
            height: 100%;
            min-height: 200px;
        }
        
        .package-title-section {
            margin-bottom: 30px;
            padding: 0 30px 20px 30px;
            border-bottom: 2px solid var(--border);
        }
        
        .package-title-name {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.8em;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }
        
        .package-title-subtitle {
            color: var(--text-light);
            font-size: 1.1em;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .benefit-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.3s;
        }
        
        .benefit-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 16px var(--shadow);
        }
        
        .benefit-icon {
            font-size: 2em;
            margin-bottom: 15px;
        }
        
        .benefit-item {
            padding: 8px 0;
            font-size: 0.95em;
            color: var(--text);
            border-bottom: 1px solid var(--border);
        }
        
        .benefit-item:last-child {
            border-bottom: none;
        }
        
        .benefit-item strong {
            color: var(--primary);
            font-weight: 700;
        }
        
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
            .header, .tabs, .btn-primary, .btn-secondary, .scenario-manager {
                display: none !important;
            }
        }
        
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .gauge-container {
                grid-template-columns: 1fr;
            }
            
            .marge-grid {
                grid-template-columns: 1fr;
            }
            
            .package-header {
                min-height: 150px;
            }
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .package-header {
                min-height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>üöÄ Calculateur de Rentabilit√© YEVO Pro</h1>
                <p>Outil avanc√© de calcul et d'analyse de rentabilit√©</p>
            </div>
            <div class="header-actions">
                <button class="btn-icon" onclick="toggleTheme()" title="Mode sombre/clair">üåì</button>
                <button class="btn-icon" onclick="exportData()" title="Exporter les donn√©es">üíæ</button>
                <button class="btn-icon" onclick="importData()" title="Importer les donn√©es">üì•</button>
            </div>
        </div>
        
        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('calcul')">üìä Calcul</button>
                <button class="tab" onclick="switchTab('graphiques')">üìà Graphiques</button>
                <button class="tab" onclick="switchTab('scenarios')">üíº Sc√©narios</button>
                <button class="tab" onclick="switchTab('comparaison')">‚öñÔ∏è Comparaison</button>
            </div>
            
            <!-- Tab Calcul -->
            <div id="tab-calcul" class="tab-content active">
            <div class="main-grid">
                <!-- Colonne Gauche -->
                <div>
                    <div class="section">
                        <div class="section-title">CALCUL MARGE</div>
                        
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label>üë§ Type de Consultant</label>
                            <select id="typeConsultant" onchange="toggleConsultantType()">
                                <option value="salarie">Salari√©</option>
                                <option value="independant">Ind√©pendant</option>
                            </select>
                        </div>
                        
                        <div id="salarieSection">
                            <h3 style="color: var(--primary); margin: 15px 0 10px 0; font-size: 0.95em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">üí∞ R√©mun√©ration</h3>
                            
                            <div class="form-group">
                                <label>Salaire Brut Annuel - ‚Ç¨</label>
                                <input type="number" id="brutAnnuel" value="30000" min="0" step="1000" oninput="calculer()">
                            </div>
                        </div>
                        
                        <div id="independantSection" style="display: none;">
                            <h3 style="color: var(--primary); margin: 25px 0 15px 0; font-size: 1.1em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">üíº Co√ªt Journalier Moyen (CJM)</h3>
                            
                            <div class="form-group">
                                <label>CJM (Co√ªt d'achat) - ‚Ç¨</label>
                                <input type="number" id="cjmManuel" value="300" min="0" step="10" oninput="calculer()" placeholder="Saisir le CJM d'achat">
                                <small style="color: var(--text-light); font-size: 0.85em; display: block; margin-top: 5px;">
                                    üí° Co√ªt journalier moyen auquel vous achetez le consultant ind√©pendant (ex: 300‚Ç¨/jour)
                                </small>
                            </div>
                        </div>
                        
                        <div id="salarieDetails">
                            <div class="result-card">
                                <div class="result-label">Brut Mensuel</div>
                                <div class="result-value" id="brutMensuel">2 500,00 ‚Ç¨</div>
                            </div>
                            
                            <h3 style="color: var(--primary); margin: 25px 0 15px 0; font-size: 1.1em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">üöó Frais Journalier</h3>
                            
                            <div class="form-group">
                                <label>Frais de D√©placement (par jour) - ‚Ç¨</label>
                                <input type="number" id="fraisDeplacement" value="2.91" min="0" step="0.01" oninput="calculer()">
                            </div>
                            
                            <div class="form-group">
                                <label>Frais de Bouche (par jour) - ‚Ç¨</label>
                                <select id="fraisBouche" onchange="calculer()">
                                    <option value="6">6,00 ‚Ç¨</option>
                                    <option value="0">0,00 ‚Ç¨</option>
                                </select>
                            </div>
                            
                            <h3 style="color: var(--primary); margin: 25px 0 15px 0; font-size: 1.1em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">üè• Pr√©voyance + Mutuelle</h3>
                            
                            <div class="form-group">
                                <label>Type de Mutuelle</label>
                                <select id="typeMutuelle" onchange="calculer()">
                                    <option value="Isol√©">Isol√©</option>
                                    <option value="Famille">Famille</option>
                                </select>
                            </div>
                            
                            <div class="result-card">
                                <div class="result-label">Mutuelle Mensuelle</div>
                                <div class="result-value" id="mutuelle">39,25 ‚Ç¨</div>
                            </div>
                            
                            <div class="result-card">
                                <div class="result-label">Pr√©voyance</div>
                                <div class="result-value" id="prevoyance">45,00 ‚Ç¨</div>
                            </div>
                        </div>
                        
                        <!-- Section TOTAL FRAIS dans la colonne gauche -->
                        <div id="salarieSectionsGauche">
                            <h3 style="color: var(--primary); margin: 15px 0 10px 0; font-size: 0.95em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">üí∞ TOTAL FRAIS</h3>
                            
                            <div class="result-card">
                                <div class="result-label">Frais Jour</div>
                                <div class="result-value" id="fraisJour">8,91 ‚Ç¨</div>
                            </div>
                            
                            <div class="result-card">
                                <div class="result-label">Frais Mois</div>
                                <div class="result-value" id="fraisMois">161,81 ‚Ç¨</div>
                            </div>
                            
                            <div class="result-card">
                                <div class="result-label">Frais Annuel</div>
                                <div class="result-value highlight" id="fraisAnnuel">1 941,67 ‚Ç¨</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Colonne Droite -->
                <div id="colonneDroite">
                    <!-- Encart MARGE MC2 - Toujours visible -->
                    <div class="marge-section">
                        <div class="marge-title">üíº MARGE MC2</div>
                        
                        <div class="marge-grid">
                            <div class="marge-item">
                                <div class="marge-item-label">üí∞ Co√ªt</div>
                                <div class="marge-item-value">CJM: <span id="cjm">288,78 ‚Ç¨</span></div>
                            </div>
                            
                            <div class="marge-item">
                                <div class="marge-item-label">üíµ Tarif</div>
                                <div class="marge-item-value" style="color: #FF4991;">TJM: <span id="tjm">600,00 ‚Ç¨</span></div>
                            </div>
                            
                            <div class="marge-item">
                                <div class="marge-item-label">üìä Objectif 30% min</div>
                                <div class="marge-item-value" id="rentabiliteContainer">Rentabilit√©: <span id="rentabilite">51,87%</span></div>
                            </div>
                            
                            <div class="marge-item">
                                <div class="marge-item-label">üéØ Objectif min 100‚Ç¨</div>
                                <div class="marge-item-value" id="margeJourContainer">Marge/jour: <span id="margeJour">311,22 ‚Ç¨</span></div>
                            </div>
                        </div>
                        
                        <div class="marge-controls">
                            <div class="form-group">
                                <label>‚úèÔ∏è TJM Propos√© (modifiable) - ‚Ç¨</label>
                                <input type="number" id="tjmInput" value="600" min="0" step="10" oninput="calculer()">
                            </div>
                            
                            <div class="marge-result-card">
                                <div class="result-label">üìà Marge / Mois (base 18,16 jours)</div>
                                <div class="result-value highlight" id="margeMois">5 602,04 ‚Ç¨</div>
                            </div>
                            
                            <div id="rentabiliteAlert" style="margin-top: 15px;"></div>
                        </div>
                    </div>
                    
                    <div id="salarieSectionsDroite2">
                        <div class="section" style="margin-top: 15px;">
                            <div class="section-title">üíµ TOTAL SALAIRE</div>
                            
                            <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                                <div class="summary-item">
                                    <div class="summary-label">üìÖ Salaire Net Mensuel</div>
                                    <div class="summary-value" id="salaireNet">2 036,81 ‚Ç¨</div>
                                </div>
                                
                                <div class="summary-item highlight-item">
                                    <div class="summary-label">üìä Salaire Brut Annuel</div>
                                    <div class="summary-value highlight" id="salaireBrutTotal">32 588,89 ‚Ç¨</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section Package Consultant -->
            <div id="packageConsultantSection" class="package-section">
                    <div class="package-title">üìã PACKAGE CONSULTANT</div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Nom du Consultant</label>
                        <input type="text" id="packageConsultantName" placeholder="Jean Dupont">
                    </div>
                    
                    <div class="form-group">
                        <label>Poste</label>
                        <input type="text" id="packagePoste" placeholder="Consultant IT">
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label>üìß Email du Candidat</label>
                    <input type="email" id="packageCandidateEmail" placeholder="candidat@example.com">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Statut</label>
                        <select id="statut" onchange="updateRegimeOptions()">
                            <option value="CADRE">CADRE</option>
                            <option value="ETAM">ETAM</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>R√©gime de travail</label>
                        <select id="regimeTravail">
                            <option value="Forfait jour">Forfait jour</option>
                            <option value="Forfait heure 37,5h">Forfait heure 37,5h</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Type d'Avantage</label>
                        <select id="typeAvantage">
                            <option value="Aucun">Aucun</option>
                            <option value="IK">Indemnit√© Kilom√©trique (IK)</option>
                            <option value="IDG">Indemnit√© de Grand D√©placement (IDG)</option>
                            <option value="Transport">Abonnement Transport en Commun</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Tickets Restaurant</label>
                        <select id="ticketsResto">
                            <option value="6">Oui - 6‚Ç¨ / jour</option>
                            <option value="0">Non</option>
                        </select>
                    </div>
                </div>
                
                    <div style="text-align: center; margin-top: 25px;">
                    <button class="btn-primary" onclick="genererPackage()">
                        üìÑ G√©n√©rer Package Consultant
                    </button>
                        <button class="btn-secondary" onclick="sauvegarderScenario()" style="margin-left: 15px;">
                            üíæ Sauvegarder Sc√©nario
                    </button>
                </div>
            </div>
            
            <!-- Section Proposition -->
            <div id="propositionSection" class="hidden">
                <div class="package-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px; padding: 20px 30px 0 30px; margin-bottom: 0; flex-wrap: wrap;">
                        <button onclick="exportPDF()" class="btn-primary">üìÑ Imprimer / PDF</button>
                        <button onclick="exportPDF()" class="btn-secondary">üíæ Exporter PDF</button>
                        <div style="position: relative;">
                            <button onclick="toggleExportMenu()" class="btn-secondary">üöÄ Exporter vers...</button>
                            <div id="exportMenu" class="export-menu hidden">
                                <button onclick="exportToHTML()" class="export-option">üåê HTML</button>
                                <button onclick="exportToNotion()" class="export-option">üìù Notion</button>
                                <button onclick="exportToLocalStorage()" class="export-option">üíæ Stockage Local</button>
                                <button onclick="exportToJSON()" class="export-option">üìã JSON</button>
                                <button onclick="exportToCSV()" class="export-option">üìä CSV</button>
                                <button onclick="exportToEmail()" class="export-option">üìß Email</button>
                                <button onclick="exportToWebhook()" class="export-option">üîó Webhook</button>
                                <button onclick="configureWebhook()" class="export-option" style="border-top: 1px solid var(--border); margin-top: 4px; padding-top: 12px;">‚öôÔ∏è Configurer Webhook</button>
                            </div>
                        </div>
                    </div>
                    <div id="propositionContent"></div>
                </div>
            </div>
            </div>
            
            <!-- Tab Graphiques -->
            <div id="tab-graphiques" class="tab-content">
                <div class="chart-container">
                    <h3 style="font-family: 'Outfit', sans-serif; color: var(--primary); margin-bottom: 20px; font-size: 1.5em;">üìä Analyse de Rentabilit√©</h3>
                    <canvas id="rentabiliteChart" style="max-height: 400px;"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3 style="font-family: 'Outfit', sans-serif; color: var(--primary); margin-bottom: 20px; font-size: 1.5em;">üí∞ R√©partition des Co√ªts</h3>
                    <canvas id="coutChart" style="max-height: 400px;"></canvas>
                </div>
            </div>
            
            <!-- Tab Sc√©narios -->
            <div id="tab-scenarios" class="tab-content">
                <div class="scenario-manager">
                    <h3 style="font-family: 'Outfit', sans-serif; color: var(--primary); margin-bottom: 20px; font-size: 1.5em;">üíº Gestion des Sc√©narios</h3>
                    
                    <div class="input-group">
                        <input type="text" id="scenarioName" placeholder="Nom du sc√©nario (ex: Consultant Senior)" style="flex: 1;">
                        <button class="btn-primary" onclick="sauvegarderScenario()">üíæ Sauvegarder</button>
                    </div>
                    
                    <div class="scenario-list" id="scenarioList"></div>
                </div>
            </div>
            
            <!-- Tab Comparaison -->
            <div id="tab-comparaison" class="tab-content">
                <div class="scenario-manager">
                    <h3 style="font-family: 'Outfit', sans-serif; color: var(--primary); margin-bottom: 20px; font-size: 1.5em;">‚öñÔ∏è Comparaison de Sc√©narios</h3>
                    <p style="color: var(--text-light); margin-bottom: 20px;">S√©lectionnez jusqu'√† 3 sc√©narios √† comparer</p>
                    
                    <div class="comparison-grid" id="comparisonGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTheme = 'light';
        let scenarios = JSON.parse(localStorage.getItem('yevo-scenarios') || '[]');
        let selectedScenarios = [];
        let charts = {};
        
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('yevo-theme', currentTheme);
            updateCharts();
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            if (window.event && window.event.target) {
                window.event.target.classList.add('active');
            }
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            if (tabName === 'graphiques') {
                setTimeout(() => updateCharts(), 100);
            } else if (tabName === 'scenarios') {
                afficherScenarios();
            } else if (tabName === 'comparaison') {
                afficherComparaison();
            }
        }
        
        function updateRegimeOptions() {
            const statut = document.getElementById('statut').value;
            const regimeTravail = document.getElementById('regimeTravail');
            
            if (statut === 'CADRE') {
                regimeTravail.innerHTML = `
                    <option value="Forfait jour">Forfait jour</option>
                    <option value="Forfait heure 37,5h">Forfait heure 37,5h</option>
                `;
            } else if (statut === 'ETAM') {
                regimeTravail.innerHTML = `
                    <option value="Forfait heure 37,5h">Forfait heure 37,5h</option>
                    <option value="Forfait heure 36h">Forfait heure 36h</option>
                `;
            }
        }
        
        function toggleConsultantType() {
            const typeConsultant = document.getElementById('typeConsultant').value;
            const salarieSection = document.getElementById('salarieSection');
            const salarieDetails = document.getElementById('salarieDetails');
            const independantSection = document.getElementById('independantSection');
            const salarieSectionsGauche = document.getElementById('salarieSectionsGauche');
            const salarieSectionsDroite2 = document.getElementById('salarieSectionsDroite2');
            const packageConsultantSection = document.getElementById('packageConsultantSection');
            const mainGrid = document.querySelector('.main-grid');
            
            if (typeConsultant === 'independant') {
                salarieSection.style.display = 'none';
                salarieDetails.style.display = 'none';
                independantSection.style.display = 'block';
                if (salarieSectionsGauche) salarieSectionsGauche.style.display = 'none'; // Masquer TOTAL FRAIS
                if (salarieSectionsDroite2) salarieSectionsDroite2.style.display = 'none'; // Masquer TOTAL SALAIRE
                packageConsultantSection.style.display = 'none'; // Masquer PACKAGE CONSULTANT
                mainGrid.classList.add('single-column');
            } else {
                salarieSection.style.display = 'block';
                salarieDetails.style.display = 'block';
                independantSection.style.display = 'none';
                if (salarieSectionsGauche) salarieSectionsGauche.style.display = 'block'; // Afficher TOTAL FRAIS
                if (salarieSectionsDroite2) salarieSectionsDroite2.style.display = 'block'; // Afficher TOTAL SALAIRE
                packageConsultantSection.style.display = 'block'; // Afficher PACKAGE CONSULTANT
                mainGrid.classList.remove('single-column');
            }
            
            // Recalculer apr√®s changement
            calculer();
        }
        
        function calculer() {
            const typeConsultant = document.getElementById('typeConsultant').value;
            const tjmInput = parseFloat(document.getElementById('tjmInput').value) || 0;
            
            let cjm;
            
            if (typeConsultant === 'independant') {
                // Pour les ind√©pendants, utiliser le CJM saisi manuellement
                cjm = parseFloat(document.getElementById('cjmManuel').value) || 0;
            } else {
                // Pour les salari√©s, calculer le CJM automatiquement
                const brutAnnuel = parseFloat(document.getElementById('brutAnnuel').value) || 0;
                const fraisDeplacement = parseFloat(document.getElementById('fraisDeplacement').value) || 0;
                const typeMutuelle = document.getElementById('typeMutuelle').value;
                const fraisBouche = parseFloat(document.getElementById('fraisBouche').value) || 0;
                const mutuelle = typeMutuelle === "Isol√©" ? 39.25 : 94.2;
                
                const brutMensuel = brutAnnuel / 12;
                const prevoyance = (1.8 / 100 * brutAnnuel) / 12;
                
                const fraisJour = fraisDeplacement + fraisBouche;
                const fraisMois = fraisJour * 18.16;
                const fraisAnnuel = fraisMois * 12;
                
                cjm = (((brutAnnuel * 2) + fraisAnnuel) / 218) + ((mutuelle + prevoyance) / 18.16);
                
                // Mise √† jour des valeurs pour les salari√©s
                document.getElementById('brutMensuel').textContent = formatCurrency(brutMensuel);
                document.getElementById('mutuelle').textContent = formatCurrency(mutuelle);
                document.getElementById('prevoyance').textContent = formatCurrency(prevoyance);
                document.getElementById('fraisJour').textContent = formatCurrency(fraisJour);
                document.getElementById('fraisMois').textContent = formatCurrency(fraisMois);
                document.getElementById('fraisAnnuel').textContent = formatCurrency(fraisAnnuel);
                
                const salaireNet = ((brutAnnuel * 0.75) / 12) + fraisMois;
                const salaireBrutTotal = brutAnnuel + (fraisAnnuel / 0.75);
                document.getElementById('salaireNet').textContent = formatCurrency(salaireNet);
                document.getElementById('salaireBrutTotal').textContent = formatCurrency(salaireBrutTotal);
            }
            
            const margeJour = tjmInput - cjm;
            const margeMois = margeJour * 18.16;
            const rentabilite = tjmInput > 0 ? ((margeJour / tjmInput) * 100) : 0;
            
            // Mise √† jour des valeurs communes (CJM, TJM, Marge, Rentabilit√©)
            document.getElementById('cjm').textContent = formatCurrency(cjm);
            document.getElementById('tjm').textContent = formatCurrency(tjmInput);
            document.getElementById('margeJour').textContent = formatCurrency(margeJour);
            document.getElementById('margeMois').textContent = formatCurrency(margeMois);
            document.getElementById('rentabilite').textContent = formatPercent(rentabilite);
            
            // Mise √† jour du style de la marge/jour (vert >= 100‚Ç¨, orange 80-99.99‚Ç¨, rouge < 80‚Ç¨)
            const margeJourContainer = document.getElementById('margeJourContainer');
            if (margeJour >= 100) {
                margeJourContainer.style.color = '#10b981'; // Vert
            } else if (margeJour >= 80) {
                margeJourContainer.style.color = '#f59e0b'; // Orange
            } else {
                margeJourContainer.style.color = '#ef4444'; // Rouge
            }
            
            // Mise √† jour du style de la rentabilit√© (vert >= 30%, orange 20-29.99%, rouge < 20%)
            const rentabiliteContainer = document.getElementById('rentabiliteContainer');
            if (rentabilite >= 30) {
                rentabiliteContainer.style.color = '#10b981'; // Vert
            } else if (rentabilite >= 20) {
                rentabiliteContainer.style.color = '#f59e0b'; // Orange
            } else {
                rentabiliteContainer.style.color = '#ef4444'; // Rouge
            }
            
            // Alerte rentabilit√©
            updateRentabiliteAlert(rentabilite);
            
            // Mise √† jour des graphiques
            if (Object.keys(charts).length > 0) {
                updateCharts();
            }
        }
        
        function formatCurrency(value) {
            return value.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' ‚Ç¨';
        }
        
        function formatPercent(value) {
            return value.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '%';
        }
        
        function updateRentabiliteAlert(rentabilite) {
            const alertDiv = document.getElementById('rentabiliteAlert');
            if (rentabilite >= 30) {
                alertDiv.innerHTML = '<div class="alert alert-success">‚úÖ Excellente rentabilit√© ! Objectif de 30% d√©pass√©.</div>';
            } else if (rentabilite >= 20) {
                alertDiv.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Rentabilit√© correcte mais en dessous de l\'objectif de 30%.</div>';
            } else {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ùå Rentabilit√© insuffisante. Augmentez le TJM ou r√©duisez les co√ªts.</div>';
            }
        }
        
        function updateCharts() {
            const typeConsultant = document.getElementById('typeConsultant').value;
            const tjmInput = parseFloat(document.getElementById('tjmInput').value) || 0;
            
            let cjm;
            
            if (typeConsultant === 'independant') {
                // Pour les ind√©pendants, utiliser le CJM saisi manuellement
                cjm = parseFloat(document.getElementById('cjmManuel').value) || 0;
            } else {
                // Pour les salari√©s, calculer le CJM automatiquement
                const brutAnnuel = parseFloat(document.getElementById('brutAnnuel').value) || 0;
                const fraisDeplacement = parseFloat(document.getElementById('fraisDeplacement').value) || 0;
                const typeMutuelle = document.getElementById('typeMutuelle').value;
                const fraisBouche = parseFloat(document.getElementById('fraisBouche').value) || 0;
                const mutuelle = typeMutuelle === "Isol√©" ? 39.25 : 94.2;
                const prevoyance = (1.8 / 100 * brutAnnuel) / 12;
                const fraisJour = fraisDeplacement + fraisBouche;
                const fraisMois = fraisJour * 18.16;
                const fraisAnnuel = fraisMois * 12;
                cjm = (((brutAnnuel * 2) + fraisAnnuel) / 218) + ((mutuelle + prevoyance) / 18.16);
            }
            
            const margeJour = tjmInput - cjm;
            const rentabilite = tjmInput > 0 ? ((margeJour / tjmInput) * 100) : 0;
            
            // Jours ouvr√©s par mois (2024 - moyenne France)
            const joursOuvresParMois = [22, 20, 21, 22, 21, 20, 22, 22, 21, 22, 20, 22];
            const totalJoursOuvresAnnee = joursOuvresParMois.reduce((a, b) => a + b, 0);
            
            // Calcul de la marge mensuelle avec jours ouvr√©s r√©els
            const margeMensuelleParMois = joursOuvresParMois.map(jours => margeJour * jours);
            
            // Graphique Rentabilit√©
            if (charts.rentabilite) charts.rentabilite.destroy();
            const rentabiliteCtx = document.getElementById('rentabiliteChart').getContext('2d');
            charts.rentabilite = new Chart(rentabiliteCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Ao√ª', 'Sep', 'Oct', 'Nov', 'D√©c'],
                    datasets: [{
                        label: 'Marge Mensuelle (‚Ç¨) - Jours ouvr√©s r√©els',
                        data: margeMensuelleParMois,
                        borderColor: '#5747f9',
                        backgroundColor: 'rgba(87, 71, 249, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        title: { display: false },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const moisIndex = context.dataIndex;
                                    return `(${joursOuvresParMois[moisIndex]} jours ouvr√©s)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Graphique R√©partition des Co√ªts
            if (charts.cout) charts.cout.destroy();
            const coutCtx = document.getElementById('coutChart').getContext('2d');
            charts.cout = new Chart(coutCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Salaire', 'Frais', 'Mutuelle', 'Pr√©voyance'],
                    datasets: [{
                        data: [brutAnnuel, fraisAnnuel, mutuelle * 12, prevoyance * 12],
                        backgroundColor: ['#5747f9', '#FF4991', '#10b981', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
        
        function sauvegarderScenario() {
            const nom = document.getElementById('scenarioName')?.value || 
                       document.getElementById('packageConsultantName').value || 
                       `Sc√©nario ${new Date().toLocaleDateString('fr-FR')}`;
            
            const scenario = {
                id: Date.now(),
                nom: nom,
                date: new Date().toISOString(),
                brutAnnuel: parseFloat(document.getElementById('brutAnnuel').value),
                fraisDeplacement: parseFloat(document.getElementById('fraisDeplacement').value),
                fraisBouche: document.getElementById('fraisBouche').value,
                typeMutuelle: document.getElementById('typeMutuelle').value,
                tjm: parseFloat(document.getElementById('tjmInput').value),
                statut: document.getElementById('statut').value,
                regimeTravail: document.getElementById('regimeTravail').value,
                typeAvantage: document.getElementById('typeAvantage').value,
                ticketsResto: document.getElementById('ticketsResto').value,
                consultantName: document.getElementById('packageConsultantName').value,
                poste: document.getElementById('packagePoste').value
            };
            
            scenarios.push(scenario);
            localStorage.setItem('yevo-scenarios', JSON.stringify(scenarios));
            afficherScenarios();
            
            if (document.getElementById('scenarioName')) {
                document.getElementById('scenarioName').value = '';
            }
        }
        
        function afficherScenarios() {
            const listDiv = document.getElementById('scenarioList');
            if (!listDiv) return;
            
            listDiv.innerHTML = '';
            
            scenarios.forEach(scenario => {
                const card = document.createElement('div');
                card.className = 'scenario-card';
                card.innerHTML = `
                    <div class="scenario-name">${scenario.nom}</div>
                    <div class="scenario-details">
                        <div>üí∞ Brut: ${formatCurrency(scenario.brutAnnuel)}</div>
                        <div>üìä TJM: ${formatCurrency(scenario.tjm)}</div>
                        <div>üìÖ ${new Date(scenario.date).toLocaleDateString('fr-FR')}</div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn-secondary" onclick="chargerScenario(${scenario.id})" style="flex: 1; padding: 8px;">Charger</button>
                        <button class="btn-secondary" onclick="supprimerScenario(${scenario.id})" style="flex: 1; padding: 8px; background: var(--danger); color: white; border-color: var(--danger);">Supprimer</button>
                    </div>
                `;
                listDiv.appendChild(card);
            });
        }
        
        function chargerScenario(id) {
            const scenario = scenarios.find(s => s.id === id);
            if (!scenario) return;
            
            document.getElementById('brutAnnuel').value = scenario.brutAnnuel;
            document.getElementById('fraisDeplacement').value = scenario.fraisDeplacement;
            document.getElementById('fraisBouche').value = scenario.fraisBouche;
            document.getElementById('typeMutuelle').value = scenario.typeMutuelle;
            document.getElementById('tjmInput').value = scenario.tjm;
            document.getElementById('statut').value = scenario.statut;
            document.getElementById('regimeTravail').value = scenario.regimeTravail;
            document.getElementById('typeAvantage').value = scenario.typeAvantage;
            document.getElementById('ticketsResto').value = scenario.ticketsResto;
            if (scenario.consultantName) document.getElementById('packageConsultantName').value = scenario.consultantName;
            if (scenario.poste) document.getElementById('packagePoste').value = scenario.poste;
            
            updateRegimeOptions();
            calculer();
            switchTab('calcul');
        }
        
        function supprimerScenario(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce sc√©nario ?')) {
                scenarios = scenarios.filter(s => s.id !== id);
                localStorage.setItem('yevo-scenarios', JSON.stringify(scenarios));
                afficherScenarios();
            }
        }
        
        function afficherComparaison() {
            const grid = document.getElementById('comparisonGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            if (scenarios.length === 0) {
                grid.innerHTML = '<p style="color: var(--text-light); text-align: center; grid-column: 1/-1;">Aucun sc√©nario sauvegard√©. Cr√©ez des sc√©narios dans l\'onglet "Sc√©narios".</p>';
                return;
            }
            
            scenarios.slice(0, 3).forEach(scenario => {
                const brutAnnuel = scenario.brutAnnuel;
                const fraisDeplacement = scenario.fraisDeplacement;
                const fraisBouche = parseFloat(scenario.fraisBouche);
                const typeMutuelle = scenario.typeMutuelle;
                const tjm = scenario.tjm;
                const mutuelle = typeMutuelle === "Isol√©" ? 39.25 : 94.2;
                const prevoyance = (1.8 / 100 * brutAnnuel) / 12;
                const fraisJour = fraisDeplacement + fraisBouche;
                const fraisMois = fraisJour * 18.16;
                const fraisAnnuel = fraisMois * 12;
                const cjm = (((brutAnnuel * 2) + fraisAnnuel) / 218) + ((mutuelle + prevoyance) / 18.16);
                const margeJour = tjm - cjm;
                const margeMois = margeJour * 18.16;
                const rentabilite = tjm > 0 ? ((margeJour / tjm) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'comparison-card';
                card.innerHTML = `
                    <h3>${scenario.nom}</h3>
                    <div class="result-card">
                        <div class="result-label">TJM</div>
                        <div class="result-value">${formatCurrency(tjm)}</div>
                    </div>
                    <div class="result-card">
                        <div class="result-label">CJM</div>
                        <div class="result-value">${formatCurrency(cjm)}</div>
                    </div>
                    <div class="result-card">
                        <div class="result-label">Marge/Jour</div>
                        <div class="result-value">${formatCurrency(margeJour)}</div>
                    </div>
                    <div class="result-card">
                        <div class="result-label">Marge/Mois</div>
                        <div class="result-value highlight">${formatCurrency(margeMois)}</div>
                    </div>
                    <div class="result-card">
                        <div class="result-label">Rentabilit√©</div>
                        <div class="result-value" style="color: ${rentabilite >= 30 ? 'var(--success)' : rentabilite >= 20 ? 'var(--warning)' : 'var(--danger)'};">${formatPercent(rentabilite)}</div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        function genererPackage() {
            const candidatName = document.getElementById('packageConsultantName').value || 'Candidat';
            const poste = document.getElementById('packagePoste').value || 'Consultant';
            const brutAnnuel = parseFloat(document.getElementById('brutAnnuel').value) || 0;
            const fraisDeplacement = parseFloat(document.getElementById('fraisDeplacement').value) || 0;
            const typeMutuelle = document.getElementById('typeMutuelle').value;
            const statut = document.getElementById('statut').value;
            const regimeTravail = document.getElementById('regimeTravail').value;
            const typeAvantage = document.getElementById('typeAvantage').value;
            const ticketsResto = document.getElementById('ticketsResto').value;
            
            const fraisBouche = parseFloat(document.getElementById('fraisBouche').value) || 0;
            const mutuelle = typeMutuelle === "Isol√©" ? 39.25 : 94.2;
            const brutMensuel = brutAnnuel / 12;
            const coeff = statut === 'ETAM' ? 0.78 : 0.75;
            
            const fraisJour = fraisDeplacement + fraisBouche;
            const fraisMois = fraisJour * 18.16;
            
            const salaireNetMensuel = (brutAnnuel * coeff) / 12;
            const fraisDeplacementNetMensuel = fraisDeplacement * 18.16;
            const fraisDeplacementBrutMensuel = fraisDeplacementNetMensuel / coeff;
            
            const ticketsBrut = ticketsResto === "6" ? 145.28 : 0;
            const ticketsNet = ticketsResto === "6" ? 108.96 : 0;
            
            let totalFraisBrut = 0;
            let totalFraisNet = 0;
            
            if (typeAvantage === 'IK' || typeAvantage === 'IDG') {
                totalFraisBrut = fraisDeplacementBrutMensuel;
                totalFraisNet = fraisDeplacementNetMensuel;
            }
            
            if (typeAvantage !== 'IDG' && ticketsResto === "6") {
                totalFraisBrut += ticketsBrut;
                totalFraisNet += ticketsNet;
            }
            
            const totalFraisAnnuel = totalFraisBrut * 12;
            const totalBrutMensuel = brutMensuel + totalFraisBrut;
            const totalNetMensuel = salaireNetMensuel + totalFraisNet;
            const totalBrutAnnuel = brutAnnuel + totalFraisAnnuel;
            
            const date = new Date().toLocaleDateString('fr-FR');
            
            let avantageLibelle = '';
            if (typeAvantage === 'IK') avantageLibelle = 'Participation au frais de d√©placement (0,10 ‚Ç¨ / km)';
            if (typeAvantage === 'IDG') avantageLibelle = 'Indemnit√© de Grand D√©placement (IDG)';
            if (typeAvantage === 'Transport') avantageLibelle = 'Abonnement Transport en Commun';
            
            let tableRows = `
                <tr class="category-row">
                    <td colspan="4">Salaire fixe (12 mois)</td>
                </tr>
                <tr>
                    <td>Salaire de base</td>
                    <td class="text-right">${formatCurrency(brutMensuel)}</td>
                    <td class="text-right">${formatCurrency(salaireNetMensuel)}</td>
                    <td class="text-right">${formatCurrency(brutAnnuel)}</td>
                </tr>
            `;
            
            if (typeAvantage !== 'Aucun' || ticketsResto === "6") {
                tableRows += `<tr class="category-row"><td colspan="4">Avantages</td></tr>`;
                
                if (typeAvantage === 'IK' || typeAvantage === 'IDG') {
                    tableRows += `
                        <tr>
                            <td>${avantageLibelle}</td>
                            <td class="text-right">${formatCurrency(fraisDeplacementBrutMensuel)}</td>
                            <td class="text-right">${formatCurrency(fraisDeplacementNetMensuel)}</td>
                            <td class="text-right">-</td>
                        </tr>
                    `;
                }
                
                if (typeAvantage === 'Transport') {
                    tableRows += `
                        <tr>
                            <td>${avantageLibelle}</td>
                            <td colspan="3" class="text-right">Pris en charge √† 100%</td>
                        </tr>
                    `;
                }
                
                if (ticketsResto === "6" && typeAvantage !== 'IDG') {
                    tableRows += `
                        <tr>
                            <td>Tickets Restaurant (carte Swile)</td>
                            <td class="text-right">${formatCurrency(ticketsBrut)}</td>
                            <td class="text-right">${formatCurrency(ticketsNet)}</td>
                            <td class="text-right">-</td>
                        </tr>
                    `;
                }
                
                tableRows += `
                    <tr class="category-row">
                        <td>Total frais</td>
                        <td class="text-right">${formatCurrency(totalFraisBrut)}</td>
                        <td class="text-right">${formatCurrency(totalFraisNet)}</td>
                        <td class="text-right">${formatCurrency(totalFraisAnnuel)}</td>
                    </tr>
                `;
            }
            
            tableRows += `
                <tr class="total-row">
                    <td>TOTAL</td>
                    <td class="text-right">${formatCurrency(totalBrutMensuel)}</td>
                    <td class="text-right">${formatCurrency(totalNetMensuel)}</td>
                    <td class="text-right">${formatCurrency(totalBrutAnnuel)}</td>
                </tr>
            `;
            
            const proposition = `
                <div class="package-header">
                    <div class="package-header-content"></div>
                </div>
                
                <div style="padding: 0 30px 30px 30px;">
                    <div class="package-title-section">
                        <div class="package-title-name">${candidatName.toUpperCase()} - Proposition contractuelle - ${statut} ${regimeTravail}</div>
                        <div class="package-title-subtitle">${date}</div>
                </div>
                
                <table class="package-table">
                    <thead>
                        <tr>
                            <th style="width: 50%;">√âl√©ments</th>
                            <th class="text-right">Brut mensuel</th>
                            <th class="text-right">Net mensuel</th>
                            <th class="text-right">Brut annuel</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
                    
                    <div class="benefits-grid">
                        <div class="benefit-card">
                            <div class="benefit-icon">üí°</div>
                            <div class="benefit-item">
                                <strong>Prime d'affaire</strong> - 1000 ‚Ç¨
                            </div>
                            <div class="benefit-item">
                                <strong>Cooptation</strong> - 1000 ‚Ç¨
                            </div>
                        </div>
                        
                        <div class="benefit-card">
                            <div class="benefit-icon">üíä</div>
                            <div class="benefit-item">
                                <strong>Mutuelle</strong> prise en charge √† 50%
                            </div>
                            <div class="benefit-item">
                                <strong>Pr√©voyance</strong> prise en charge √† 100%
                            </div>
                        </div>
                        
                        <div class="benefit-card">
                            <div class="benefit-icon">üòä</div>
                            <div class="benefit-item">
                                <strong>10 √† 11 jours de RTT</strong> (en fonction de l'ann√©e civile)
                            </div>
                            <div class="benefit-item">
                                <strong>25 jours de CP</strong>
                            </div>
                        </div>
                        
                        <div class="benefit-card">
                            <div class="benefit-icon">üéÅ</div>
                            <div class="benefit-item">
                                <strong>CE externalis√©</strong> (Club-employ√©s)
                            </div>
                        </div>
                        
                        <div class="benefit-card" style="grid-column: 1 / -1;">
                            <div class="benefit-icon">üçÉ</div>
                            <div class="benefit-item">
                                <strong>Prime vacances</strong>
                            </div>
                            <div class="benefit-item">
                                <strong>Participation aux b√©n√©fices de l'entreprise</strong>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('propositionContent').innerHTML = proposition;
            document.getElementById('propositionSection').classList.remove('hidden');
            document.getElementById('propositionSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function exportData() {
            const data = {
                scenarios: scenarios,
                current: {
                    brutAnnuel: document.getElementById('brutAnnuel').value,
                    fraisDeplacement: document.getElementById('fraisDeplacement').value,
                    fraisBouche: document.getElementById('fraisBouche').value,
                    typeMutuelle: document.getElementById('typeMutuelle').value,
                    tjm: document.getElementById('tjmInput').value
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `yevo-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.scenarios) {
                            scenarios = data.scenarios;
                            localStorage.setItem('yevo-scenarios', JSON.stringify(scenarios));
                            afficherScenarios();
                        }
                        if (data.current) {
                            document.getElementById('brutAnnuel').value = data.current.brutAnnuel;
                            document.getElementById('fraisDeplacement').value = data.current.fraisDeplacement;
                            document.getElementById('fraisBouche').value = data.current.fraisBouche;
                            document.getElementById('typeMutuelle').value = data.current.typeMutuelle;
                            document.getElementById('tjmInput').value = data.current.tjm;
                            calculer();
                        }
                        alert('Donn√©es import√©es avec succ√®s !');
                    } catch (error) {
                        alert('Erreur lors de l\'importation des donn√©es.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function getPackageHTML() {
            const propositionSection = document.getElementById('propositionSection');
            if (!propositionSection || propositionSection.classList.contains('hidden')) {
                alert('‚ö†Ô∏è Veuillez d\'abord g√©n√©rer un package consultant.');
                return null;
            }
            
            const packageContent = document.getElementById('propositionContent').innerHTML;
            
            // R√©cup√©rer tous les styles
            let allStyles = '';
            document.querySelectorAll('style').forEach(style => {
                allStyles += style.innerHTML;
            });
            
            // Cr√©er un document HTML minimal avec juste le package
            const styles = `
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    body { font-family: 'Syne', sans-serif; background: white; padding: 20px; }
                    ${allStyles}
                    .package-section { margin: 0; border-radius: 0; box-shadow: none; padding: 0 !important; }
                    .btn-primary, .btn-secondary, .export-menu, [onclick*="print"], [onclick*="export"] { display: none !important; }
                    @media print {
                        body { padding: 0; }
                        .package-section { page-break-inside: avoid; }
                    }
                </style>
            `;
            
            return `
                <!DOCTYPE html>
                <html lang="fr">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Package Salarial</title>
                    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Syne:wght@400;500;600;700&display=swap" rel="stylesheet">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script>
                    ${styles}
                </head>
                <body>
                    <div class="package-section">
                        ${packageContent}
                    </div>
                </body>
                </html>
            `;
        }
        
        function exportPDF() {
            const html = getPackageHTML();
            if (!html) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }
        
        function toggleExportMenu() {
            const menu = document.getElementById('exportMenu');
            menu.classList.toggle('hidden');
        }
        
        // Fermer le menu si on clique ailleurs
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('exportMenu');
            const button = event.target.closest('[onclick="toggleExportMenu()"]');
            if (menu && !menu.contains(event.target) && !button) {
                menu.classList.add('hidden');
            }
        });
        
        function getPackageData() {
            const candidatName = document.getElementById('packageConsultantName').value || 'Candidat';
            const poste = document.getElementById('packagePoste').value || 'Consultant';
            const candidateEmail = document.getElementById('packageCandidateEmail').value || '';
            const brutAnnuel = parseFloat(document.getElementById('brutAnnuel').value) || 0;
            const fraisDeplacement = parseFloat(document.getElementById('fraisDeplacement').value) || 0;
            const typeMutuelle = document.getElementById('typeMutuelle').value;
            const statut = document.getElementById('statut').value;
            const regimeTravail = document.getElementById('regimeTravail').value;
            const typeAvantage = document.getElementById('typeAvantage').value;
            const ticketsResto = document.getElementById('ticketsResto').value;
            const tjm = parseFloat(document.getElementById('tjmInput').value) || 0;
            
            const fraisBouche = parseFloat(document.getElementById('fraisBouche').value) || 0;
            const mutuelle = typeMutuelle === "Isol√©" ? 39.25 : 94.2;
            const brutMensuel = brutAnnuel / 12;
            const coeff = statut === 'ETAM' ? 0.78 : 0.75;
            
            const fraisJour = fraisDeplacement + fraisBouche;
            const fraisMois = fraisJour * 18.16;
            
            const salaireNetMensuel = (brutAnnuel * coeff) / 12;
            const fraisDeplacementNetMensuel = fraisDeplacement * 18.16;
            const fraisDeplacementBrutMensuel = fraisDeplacementNetMensuel / coeff;
            
            const ticketsBrut = ticketsResto === "6" ? 145.28 : 0;
            const ticketsNet = ticketsResto === "6" ? 108.96 : 0;
            
            let totalFraisBrut = 0;
            let totalFraisNet = 0;
            
            if (typeAvantage === 'IK' || typeAvantage === 'IDG') {
                totalFraisBrut = fraisDeplacementBrutMensuel;
                totalFraisNet = fraisDeplacementNetMensuel;
            }
            
            if (typeAvantage !== 'IDG' && ticketsResto === "6") {
                totalFraisBrut += ticketsBrut;
                totalFraisNet += ticketsNet;
            }
            
            const totalFraisAnnuel = totalFraisBrut * 12;
            const totalBrutMensuel = brutMensuel + totalFraisBrut;
            const totalNetMensuel = salaireNetMensuel + totalFraisNet;
            const totalBrutAnnuel = brutAnnuel + totalFraisAnnuel;
            
            return {
                candidatName,
                poste,
                candidateEmail,
                statut,
                regimeTravail,
                date: new Date().toISOString(),
                brutAnnuel,
                brutMensuel,
                salaireNetMensuel,
                totalBrutMensuel,
                totalNetMensuel,
                totalBrutAnnuel,
                fraisDeplacement,
                fraisBouche,
                typeMutuelle,
                mutuelle,
                typeAvantage,
                ticketsResto,
                tjm,
                totalFraisBrut,
                totalFraisNet,
                totalFraisAnnuel
            };
        }
        
        function exportToHTML() {
            const html = getPackageHTML();
            if (!html) return;
            
            const data = getPackageData();
            const blob = new Blob([html], { type: 'text/html;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `package-${data.candidatName.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
            document.getElementById('exportMenu').classList.add('hidden');
        }
        
        function exportToNotion() {
            const html = getPackageHTML();
            if (!html) return;
            
            const data = getPackageData();
            const notionToken = localStorage.getItem('notion-token') || '';
            const notionDatabaseId = localStorage.getItem('notion-database-id') || '';
            
            if (!notionToken || !notionDatabaseId) {
                showNotionConfigModal();
                return;
            }
            
            // Cr√©er une page dans Notion avec le HTML du package
            fetch('https://api.notion.com/v1/pages', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${notionToken}`,
                    'Content-Type': 'application/json',
                    'Notion-Version': '2022-06-28'
                },
                body: JSON.stringify({
                    parent: { database_id: notionDatabaseId },
                    properties: {
                        'Nom': { title: [{ text: { content: data.candidatName } }] },
                        'Poste': { rich_text: [{ text: { content: data.poste } }] },
                        'Statut': { select: { name: data.statut } },
                        'R√©gime': { rich_text: [{ text: { content: data.regimeTravail } }] },
                        'Brut Annuel': { number: data.totalBrutAnnuel },
                        'Net Mensuel': { number: data.totalNetMensuel },
                        'Date': { date: { start: data.date.split('T')[0] } }
                    },
                    children: [
                        {
                            object: 'block',
                            type: 'embed',
                            embed: {
                                url: 'data:text/html;base64,' + btoa(unescape(encodeURIComponent(html)))
                            }
                        }
                    ]
                })
            })
            .then(response => response.json())
            .then(result => {
                alert('‚úÖ Package export√© vers Notion avec succ√®s !');
                document.getElementById('exportMenu').classList.add('hidden');
            })
            .catch(error => {
                console.error('Erreur Notion:', error);
                alert('‚ùå Erreur lors de l\'export vers Notion. V√©rifiez votre token et Database ID.');
            });
        }
        
        function exportToLocalStorage() {
            const html = getPackageHTML();
            if (!html) return;
            
            const data = getPackageData();
            const packages = JSON.parse(localStorage.getItem('yevo-packages') || '[]');
            packages.push({
                ...data,
                id: Date.now(),
                html: html
            });
            localStorage.setItem('yevo-packages', JSON.stringify(packages));
            alert('‚úÖ Package sauvegard√© dans le stockage local !');
            document.getElementById('exportMenu').classList.add('hidden');
        }
        
        function exportToJSON() {
            const html = getPackageHTML();
            if (!html) return;
            
            const data = getPackageData();
            const exportData = {
                ...data,
                html: html,
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `package-${data.candidatName.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            document.getElementById('exportMenu').classList.add('hidden');
        }
        
        function exportToCSV() {
            const data = getPackageData();
            const csv = [
                ['Nom', 'Poste', 'Statut', 'R√©gime', 'Brut Annuel', 'Net Mensuel', 'Brut Mensuel', 'TJM', 'Date'],
                [
                    data.candidatName,
                    data.poste,
                    data.statut,
                    data.regimeTravail,
                    data.totalBrutAnnuel,
                    data.totalNetMensuel,
                    data.totalBrutMensuel,
                    data.tjm,
                    new Date(data.date).toLocaleDateString('fr-FR')
                ]
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `package-${data.candidatName.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            document.getElementById('exportMenu').classList.add('hidden');
        }
        
        function exportToEmail() {
            const html = getPackageHTML();
            if (!html) return;
            
            const data = getPackageData();
            const email = prompt('Entrez l\'adresse email de destination :');
            if (!email) return;
            
            // Cr√©er un fichier HTML en pi√®ce jointe (via data URI)
            const subject = encodeURIComponent(`Package Salarial - ${data.candidatName}`);
            const body = encodeURIComponent(`Bonjour,\n\nVeuillez trouver ci-joint le package salarial pour ${data.candidatName}.\n\nPoste: ${data.poste}\nStatut: ${data.statut}\nR√©gime: ${data.regimeTravail}\n\nBrut Annuel: ${formatCurrency(data.totalBrutAnnuel)}\nNet Mensuel: ${formatCurrency(data.totalNetMensuel)}\n\nCordialement`);
            
            window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
            document.getElementById('exportMenu').classList.add('hidden');
        }
        
        function configureWebhook() {
            const defaultWebhookUrl = 'https://hook.eu2.make.com/lnxostff8u8ietnt6069qo8bsinlg3e8';
            const currentUrl = localStorage.getItem('webhook-url') || defaultWebhookUrl;
            
            const newUrl = prompt('Entrez l\'URL du webhook Make.com :', currentUrl);
            if (newUrl && newUrl.trim()) {
                localStorage.setItem('webhook-url', newUrl.trim());
                alert('‚úÖ URL du webhook enregistr√©e avec succ√®s !');
            }
            document.getElementById('exportMenu').classList.add('hidden');
        }
        
        function exportToWebhook() {
            const propositionSection = document.getElementById('propositionSection');
            if (!propositionSection || propositionSection.classList.contains('hidden')) {
                alert('‚ö†Ô∏è Veuillez d\'abord g√©n√©rer un package consultant.');
                return;
            }
            
            // URL du webhook Make.com par d√©faut
            const defaultWebhookUrl = 'https://hook.eu2.make.com/lnxostff8u8ietnt6069qo8bsinlg3e8';
            const webhookUrl = localStorage.getItem('webhook-url') || defaultWebhookUrl;
            
            const data = getPackageData();
            
            // Afficher un message de chargement
            alert('‚è≥ G√©n√©ration du PDF et envoi au webhook Make.com...\n\nVeuillez patienter.');
            
            // Utiliser directement le contenu visible
            const packageContent = document.getElementById('propositionContent');
            if (!packageContent) {
                alert('‚ùå Erreur : Contenu du package introuvable.');
                return;
            }
            
            // S'assurer que le contenu est visible
            const originalDisplay = packageContent.style.display;
            const originalVisibility = packageContent.style.visibility;
            packageContent.style.display = 'block';
            packageContent.style.visibility = 'visible';
            
            // Options pour la g√©n√©ration du PDF
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `package-${data.candidatName.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff',
                    allowTaint: true
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait' 
                }
            };
            
            // Attendre un court d√©lai pour s'assurer que tout est rendu
            setTimeout(() => {
                // G√©n√©rer le PDF directement depuis le contenu visible
                html2pdf().set(opt).from(packageContent).output('datauristring').then(function(pdfDataUri) {
                    // Extraire le base64 du PDF
                    const base64PDF = pdfDataUri.split(',')[1];
                    
                    // Restaurer les styles originaux
                    packageContent.style.display = originalDisplay;
                    packageContent.style.visibility = originalVisibility;
                    
                    // Pr√©parer les donn√©es √† envoyer
                    const payload = {
                        type: 'package-salarial-pdf',
                        candidat: data.candidatName,
                        poste: data.poste,
                        candidateEmail: data.candidateEmail || '',
                        statut: data.statut,
                        regime: data.regimeTravail,
                        brutAnnuel: data.totalBrutAnnuel,
                        netMensuel: data.totalNetMensuel,
                        brutMensuel: data.totalBrutMensuel,
                        tjm: data.tjm,
                        date: data.date,
                        pdf: base64PDF, // PDF en base64
                        pdfFilename: opt.filename,
                        exportedAt: new Date().toISOString(),
                        // Donn√©es d√©taill√©es
                        details: {
                            salaireBase: {
                                brutMensuel: data.brutMensuel,
                                netMensuel: data.salaireNetMensuel,
                                brutAnnuel: data.brutAnnuel
                            },
                            avantages: {
                                typeAvantage: data.typeAvantage,
                                ticketsResto: data.ticketsResto,
                                mutuelle: data.typeMutuelle
                            },
                            frais: {
                                deplacement: data.fraisDeplacement,
                                bouche: data.fraisBouche,
                                totalBrut: data.totalFraisBrut,
                                totalNet: data.totalFraisNet,
                                totalAnnuel: data.totalFraisAnnuel
                            }
                        }
                    };
                
                    // Envoyer au webhook
                    fetch(webhookUrl, {
                        method: 'POST',
                        mode: 'cors',
                        cache: 'no-cache',
                        credentials: 'omit',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    })
                    .then(response => {
                        if (response.ok) {
                            alert('‚úÖ PDF envoy√© au webhook Make.com avec succ√®s !\n\nLe PDF sera d√©ploy√© sur Notion via Make.com.');
                            document.getElementById('exportMenu').classList.add('hidden');
                        } else if (response.status === 410) {
                            alert('‚ö†Ô∏è Erreur 410 Gone : Le webhook n\'est plus disponible.\n\nVeuillez configurer une nouvelle URL via "‚öôÔ∏è Configurer Webhook" dans le menu d\'export.');
                            document.getElementById('exportMenu').classList.add('hidden');
                        } else {
                            return response.text().then(text => {
                                throw new Error(`Erreur HTTP ${response.status}: ${text}`);
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Erreur webhook:', error);
                        let errorMessage = '‚ùå Erreur lors de l\'envoi du PDF au webhook.\n\n';
                        
                        if (error.message.includes('410') || error.message.includes('Gone')) {
                            errorMessage += 'Le webhook n\'est plus disponible (410 Gone).\n\n';
                            errorMessage += 'Veuillez configurer une nouvelle URL via "‚öôÔ∏è Configurer Webhook" dans le menu d\'export.';
                        } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                            errorMessage += 'Erreur de connexion r√©seau.\n\n';
                            errorMessage += 'V√©rifiez votre connexion internet et l\'URL du webhook.';
                        } else {
                            errorMessage += 'Erreur: ' + error.message;
                        }
                        
                        alert(errorMessage);
                    });
                }).catch(function(error) {
                    console.error('Erreur g√©n√©ration PDF:', error);
                    // Restaurer les styles originaux en cas d'erreur
                    packageContent.style.display = originalDisplay;
                    packageContent.style.visibility = originalVisibility;
                    alert('‚ùå Erreur lors de la g√©n√©ration du PDF: ' + error.message);
                });
            }, 500); // D√©lai pour s'assurer que le contenu est rendu
        }
        
        function showNotionConfigModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Configuration Notion</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="form-group">
                        <label>Token d'int√©gration Notion</label>
                        <input type="text" id="notionToken" placeholder="secret_..." value="${localStorage.getItem('notion-token') || ''}">
                        <small style="color: var(--text-light); font-size: 0.85em;">Cr√©ez un token sur https://www.notion.so/my-integrations</small>
                    </div>
                    <div class="form-group">
                        <label>Database ID</label>
                        <input type="text" id="notionDatabaseId" placeholder="database_id" value="${localStorage.getItem('notion-database-id') || ''}">
                        <small style="color: var(--text-light); font-size: 0.85em;">ID de la base de donn√©es Notion</small>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn-primary" onclick="saveNotionConfig()">üíæ Enregistrer</button>
                        <button class="btn-secondary" onclick="this.closest('.modal').remove()">Annuler</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function saveNotionConfig() {
            const token = document.getElementById('notionToken').value;
            const databaseId = document.getElementById('notionDatabaseId').value;
            
            if (token && databaseId) {
                localStorage.setItem('notion-token', token);
                localStorage.setItem('notion-database-id', databaseId);
                alert('‚úÖ Configuration Notion enregistr√©e !');
                document.querySelector('.modal').remove();
                exportToNotion();
            } else {
                alert('‚ùå Veuillez remplir tous les champs');
            }
        }
        
        window.onload = function() {
            // Charger le th√®me sauvegard√©
            const savedTheme = localStorage.getItem('yevo-theme') || 'light';
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            calculer();
            updateRegimeOptions();
            afficherScenarios();
            
            // Initialiser les graphiques apr√®s un court d√©lai
            setTimeout(() => {
                if (document.getElementById('rentabiliteChart')) {
                    updateCharts();
                }
            }, 500);
        };
    </script>
</body>
</html>
